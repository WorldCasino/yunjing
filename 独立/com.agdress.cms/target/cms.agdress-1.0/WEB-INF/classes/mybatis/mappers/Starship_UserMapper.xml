<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.agdress.mapper.Starship_UserMapper">

    <resultMap id="userlistVoResultMap" type="com.agdress.entity.vo.Starship_UserlistVo">
        <id column="user_id"         property="userId"      jdbcType="BIGINT"/>
        <result column="role_id"         property="role_id"      jdbcType="BIGINT"/>
        <result column="login_name"    property="login_name"    jdbcType="VARCHAR"/>
        <result column="password"    property="passWord"    jdbcType="VARCHAR"/>
        <result column="role_name"    property="role_name"    jdbcType="VARCHAR"/>
        <result column="nickname"    property="nickName"    jdbcType="VARCHAR"/>
        <result column="phone"       property="phone"       jdbcType="VARCHAR"/>
        <result column="cardnumber"  property="cardNumber"  jdbcType="BIGINT"/>
        <result column="balance"     property="balance"     jdbcType="DECIMAL"/>
        <result column="agent_name"  property="agentName"   jdbcType="VARCHAR"/>
        <result column="create_date" property="createDate"  jdbcType="TIMESTAMP"/>
        <result column="update_date" property="updateDate"  jdbcType="TIMESTAMP"/>
        <result column="ywname"      property="ywName"   jdbcType="VARCHAR"/>
        <result column="qq"          property="qq"   jdbcType="VARCHAR"/>
    </resultMap>

    <!--查询会员的分页查询-->
    <select id="selectUserListVoPage" parameterType="java.util.Map"   resultMap="userlistVoResultMap">
        SELECT
            a.user_id,
            a.login_name,
            a.password,
            a.nickname,
            a.phone,
            a.create_date,
            a.update_date,
            a.qq,
            a.role_id,
            b.agent_name,
            c.balance,
            (select count(*) from t_user_cards uc  where a.user_id=uc.user_id) as cardnumber,
            d.nickname as ywname,
            e.role_name
        FROM
            t_users a
            left join m_agents b  on b.agent_id=a.agent_id
            left join t_user_account c  on c.user_id=a.user_id
            left join t_users d  on d.user_id=a.be_user_id and d.role_id=3
            LEFT JOIN  m_roles e on a.role_id=e.role_id
        where
             a.is_delete = 0
            <if test=" userId != null and userId != '' ">
             and   a.user_id = #{userId}
            </if>
            <if test=" login_name != null and login_name != '' ">
                and   a.login_name = #{login_name}
            </if>
            <if test=" user_type != null and user_type != '' ">
                and   a.user_type = #{user_type}
            </if>
            <if test=" phone != null and phone != '' ">
                and   a.phone = #{phone}
            </if>
            <if test=" qq != null and qq != '' ">
                and   a.qq = #{qq}
            </if>
            <if test=" be_user_id != null and be_user_id != '' ">
                and   a.be_user_id = #{be_user_id}
            </if>
            <if test=" role_id != null and role_id != '' ">
                and   a.role_id = #{role_id}
            </if>
            <if test=" ywName != null and ywName != '' ">
                and   d.nickname = #{ywName}
            </if>
            <if test=" loginStartTime != null and loginStartTime != '' ">
                <![CDATA[ and TO_DAYS(a.update_date) >= TO_DAYS( #{loginStartTime}) ]]>
            </if>
            <if test=" loginEndTime != null and loginEndTime != '' ">
                <![CDATA[ and TO_DAYS(a.update_date) <= TO_DAYS( #{loginEndTime}) ]]>
            </if>
            <if test=" registerStartTime != null and registerStartTime != '' ">
                <![CDATA[ and  TO_DAYS(a.create_date) >= TO_DAYS( #{registerStartTime}) ]]>
            </if>
            <if test=" registerEndTime != null and registerEndTime != '' ">
                <![CDATA[ and TO_DAYS(a.create_date) <= TO_DAYS( #{registerEndTime}) ]]>
            </if>
     </select>


    <!--查询会员的详情 -->
    <select id="selectByUserId" parameterType="java.lang.Long"   resultType="com.agdress.entity.vo.Starship_UserVo">
        SELECT
            a.head_url,
            a.nickname,
            a.user_id,
            a.phone,
            a.create_date,
            a.update_date,
            a.be_user_id,
            b.account_id,
            b.balance,
            b.total_expend,
            b.total_income,
            b.total_withdraw,
            b.total_lottery,
            cast(b.total_income-b.total_expend as  decimal(10,2))  as action_totle,
            c.card_id,
            c.card_bank,
            c.card_no,
            c.card_name,
            d.agent_id,
            d.agent_name,
            e.nickname as ywname
         FROM
            t_users a
            LEFT JOIN t_user_account  b  ON a.user_id=b.user_id
            LEFT JOIN t_user_cards c   ON a.user_id=c.user_id
            LEFT JOIN m_agents d   ON a.agent_id=d.agent_id
            left join t_users e  on e.user_id=a.be_user_id and e.role_id=3
       WHERE
             a.user_id = #{userId}
       limit 1
    </select>







</mapper>