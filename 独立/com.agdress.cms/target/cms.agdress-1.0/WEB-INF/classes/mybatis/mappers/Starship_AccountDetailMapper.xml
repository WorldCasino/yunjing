<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.agdress.mapper.Starship_AccountDetailMapper">

    <sql id="search">
--         a.trade_status in ('10','20','30','40','50')
        a.trade_status != 99
        <if test=" user_id != null and user_id != '' ">
            and   a.user_id = #{user_id}
        </if>
        <if test=" trade_kind != null and trade_kind != '' ">
            and   a.trade_kind = #{trade_kind}
        </if>
        <if test=" trade_type != null and trade_type != '' ">
            and   a.trade_type = #{trade_type}
        </if>
        <if test=" trade_status != null and trade_status != '' ">
            and   a.trade_status = #{trade_status}
        </if>
        <if test=" is_notification != null and is_notification != '' ">
            and   a.is_notification = #{is_notification}
        </if>
        <if test=" createStartTime != null and createStartTime != '' ">
            <![CDATA[ and TO_DAYS(a.create_date)  >= TO_DAYS( #{createStartTime}) ]]>
        </if>
        <if test=" createEndTime != null and createEndTime != '' ">
            <![CDATA[ and TO_DAYS(a.create_date) <= TO_DAYS( #{createEndTime})]]>
        </if>
    </sql>


    <!--查询会员的分页查询-->
    <select id="selectAccountDetailListVoPage" parameterType="java.util.Map"   resultType="com.agdress.entity.vo.Starship_AccountDetaillistVo">
        SELECT
            a.trade_id,
            a.trade_kind,
            a.trade_status,
            a.trade_currency,
            a.amount,
            a.create_date,
            b.user_id,
            b.nickname,
            b.phone,
            c.account_id,
            c.balance,
            CAST(c.total_income-c.total_expend AS  decimal(10,2)) as action_totle,
            d.card_bank,
            d.card_no,
            d.card_name
         from
            t_user_account_detail a
            LEFT JOIN t_users b on a.user_id=b.user_id
            LEFT JOIN t_user_account c on a.account_id=c.account_id
            LEFT JOIN t_user_cards d on a.user_id=d.user_id
        where
            <include refid="search"/>
     </select>


    <!--查询账单的详情 -->
    <select id="selectByTradeId" parameterType="java.lang.Long"   resultType="com.agdress.entity.vo.Starship_AccountDetaillistVo">
        SELECT
            a.trade_id,
            a.trade_kind,
            a.trade_status,
            a.trade_currency,
            a.amount,
            a.create_date,
            b.user_id,
            b.nickname,
            b.phone,
            c.account_id,
            c.balance,
            CAST(c.total_income-c.total_expend AS  decimal(10,2)) as action_totle,
            d.card_bank,
            d.card_no,
            d.card_name
         from
            t_user_account_detail a
            LEFT JOIN t_users b on a.user_id=b.user_id
            LEFT JOIN t_user_account c on a.account_id=c.account_id
            LEFT JOIN t_user_cards d on a.user_id=d.user_id
          WHERE
             a.trade_id = #{trade_id}
       limit 1
    </select>



    <!--  统计收入 -->
    <select id="sumMoneyForType" parameterType="java.util.Map"   resultType="com.agdress.entity.vo.Starship_SumVo">
        SELECT
          sum(a.amount) as summoney,
          a.trade_kind as type
        from
            t_user_account_detail a
        where
           <include refid="search"/>
        GROUP  BY trade_kind
    </select>





</mapper>